<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Alterar Dados</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-5">
    <div class="max-w-md mx-auto bg-white p-8 rounded shadow">
        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRakETPU1WsKmBi2ppw7axi6RJ9ie0KAWookA&s" class="mx-auto mb-6 w-32">
        <h2 class="text-center font-bold mb-4">ALTERAR REGISTROS</h2>

        <select id="selCat" class="w-full border p-2 mb-4" onchange="carregarPilotos()">
            <option value="">Selecione a Categoria</option>
            <option value="PRODUCTION">PRODUCTION</option>
            <option value="SUPER PRODUCTION">SUPER PRODUCTION</option>
            <option value="PROTOTIPO">PROTOTIPO</option>
            <option value="UTV">UTV</option>
            <option value="INICIANTE">INICIANTE</option>
        </select>

        <select id="selPiloto" class="w-full border p-2 mb-4">
            <option value="">Aguardando Categoria...</option>
        </select>

        <input type="text" id="v1" placeholder="Volta 1 (00:00:000)" class="w-full border p-2 mb-2">
        <input type="text" id="v2" placeholder="Volta 2 (00:00:000)" class="w-full border p-2 mb-4">

        <button onclick="confirmarAlteracao()" class="w-full bg-orange-500 text-white p-3 rounded font-bold">CONFIRMAR ALTERAÇÃO</button>
        <br><br>
        <a href="index.html" class="block text-center text-blue-600 underline">Voltar</a>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, get, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = { /* ... mesma config ... */ };
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        window.carregarPilotos = async () => {
            const cat = document.getElementById('selCat').value;
            const snapshot = await get(ref(db, `dados/${cat}`));
            const select = document.getElementById('selPiloto');
            select.innerHTML = "";
            
            if(snapshot.exists()){
                Object.keys(snapshot.val()).forEach(p => {
                    let opt = document.createElement('option');
                    opt.value = p; opt.innerText = p;
                    select.appendChild(opt);
                });
            }
        };

        window.confirmarAlteracao = async () => {
            if(prompt("Senha:") !== "123456") return alert("Senha incorreta");
            
            const cat = document.getElementById('selCat').value;
            const p = document.getElementById('selPiloto').value;
            const v1 = document.getElementById('v1').value;
            const v2 = document.getElementById('v2').value;

            await update(ref(db, `dados/${cat}/${p}`), { volta1: v1, volta2: v2 });
            alert("Atualizado com sucesso!");
        };
    </script>
</body>
</html>