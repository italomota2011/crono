<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Alterar Tempos - Sistema Crono</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; text-align: center; background-color: #f0f2f5; padding: 20px; }
        .card { max-width: 450px; margin: auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        img { width: 150px; margin-bottom: 20px; }
        input, select, button { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box; }
        .btn-update { background-color: #f39c12; color: white; border: none; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>
    <div class="card">
        <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRakETPU1WsKmBi2ppw7axi6RJ9ie0KAWookA&s" alt="Logo">
        <h3>Alterar Dados do Piloto</h3>
        <select id="categoria" onchange="buscarPilotos()">
            <option value="">-- Categoria --</option>
            <option value="PRODUCTION">PRODUCTION</option>
            <option value="SUPER PRODUCTION">SUPER PRODUCTION</option>
            <option value="PROTOTIPO">PROTOTIPO</option>
            <option value="UTV">UTV</option>
            <option value="INICIANTE">INICIANTE</option>
        </select>
        <select id="piloto" onchange="preencherTempos()">
            <option value="">-- Selecione o Piloto --</option>
        </select>
        <input type="text" id="v1" placeholder="Volta 1 (00:00:000)" maxlength="9">
        <input type="text" id="v2" placeholder="Volta 2 (00:00:000)" maxlength="9">
        <button class="btn-update" onclick="salvarAlteracao()">CONFIRMAR (SENHA)</button>
        <button onclick="window.location.href='index.html'">VOLTAR</button>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyC4ajZM_W0_qGOlrlRoPn6DUsUBUm4qAcc",
            authDomain: "crono-rrb.firebaseapp.com",
            databaseURL: "https://crono-rrb-default-rtdb.firebaseio.com",
            projectId: "crono-rrb",
            storageBucket: "crono-rrb.firebasestorage.app",
            messagingSenderId: "1472207720",
            appId: "1:1472207720:web:11502aed4117b1fda714dd"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        let dados = {};

        function buscarPilotos() {
            const cat = document.getElementById('categoria').value;
            db.ref('pilotos').orderByChild('categoria').equalTo(cat).once('value', snap => {
                dados = snap.val() || {};
                const s = document.getElementById('piloto');
                s.innerHTML = '<option value="">-- Pilotos --</option>';
                for (let id in dados) {
                    let opt = document.createElement('option');
                    opt.value = id; opt.text = dados[id].piloto; s.appendChild(opt);
                }
            });
        }

        function preencherTempos() {
            const id = document.getElementById('piloto').value;
            if (id) {
                document.getElementById('v1').value = dados[id].volta1;
                document.getElementById('v2').value = dados[id].volta2;
            }
        }

        function salvarAlteracao() {
            const id = document.getElementById('piloto').value;
            if (!id || prompt("Senha:") !== "123456") return alert("Erro ou senha incorreta.");
            db.ref('pilotos/' + id).update({
                volta1: document.getElementById('v1').value,
                volta2: document.getElementById('v2').value
            }).then(() => alert("Atualizado!"));
        }
    </script>
</body>
</html>